<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>Cluster Configuration &mdash; Trusted Analytics Package 1.1.0 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="f_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="f_static/css/spc-extend.css">
    <link rel="stylesheet" href="f_static/scipy.css" type="text/css" >
    <link rel="stylesheet" href="f_static/pygments.css" type="text/css" >
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="f_static/jquery.js"></script>
    <script type="text/javascript" src="f_static/underscore.js"></script>
    <script type="text/javascript" src="f_static/doctools.js"></script>
    <script type="text/javascript" src="f_static/js/copybutton.js"></script>
    <link rel="index" title="Index" href="genindex.html" >
    <link rel="top" title="Trusted Analytics Package 1.1.0 documentation" href="index.html" >
    <link rel="up" title="Best Known Methods (Admin)" href="ad_bkm.html" >
    <link rel="next" title="Giraph Performance Tuning and Benchmarking" href="ad_gitune.html" >
    <link rel="prev" title="Best Known Methods (Admin)" href="ad_bkm.html" > 
  </head>
  <body>

  <div class="container">
    <div class="header">
    </div>
  </div>


    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
	
        <li class="active"><a href="index.html">Trusted Analytics</a></li>
	
          <li class="active"><a href="ad_over.html" >Administration</a></li>
          <li class="active"><a href="ad_bkm.html" accesskey="U">Best Known Methods (Admin)</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="ad_bkm.html" title="Best Known Methods (Admin)"
           accesskey="P">previous</a>
      </li>
      <li class="active">
        <a href="ad_gitune.html" title="Giraph Performance Tuning and Benchmarking"
           accesskey="N">next</a>
      </li>
      <li class="active">
        <a href="genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Technical Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds_over.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_over.html">Extending Trusted Analytics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="ad_over.html">Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ad_reqs.html">System Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad_inst_ta1.html">Package Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad_scoring_engine.html">Scoring Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad_inst_vm.html">Virtual Machines</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="ad_bkm.html">Best Known Methods (Admin)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad_other.html">Windows Python Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad_other.html#integrated-development-environments">Integrated Development Environments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest_api/v1/index.html">REST API</a></li>
</ul>
<ul class="simple">
</ul>

        </div>
      </div>
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
            
  <div class="section" id="cluster-configuration">
<h1>Cluster Configuration<a class="headerlink" href="#cluster-configuration" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#installation" id="id7">Installation</a><ul>
<li><a class="reference internal" href="#requirements" id="id8">Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#help" id="id9">Help</a><ul>
<li><a class="reference internal" href="#common-options" id="id10">Common Options</a></li>
<li><a class="reference internal" href="#help-em-cluster-generate" id="id11">Help — cluster-generate</a></li>
<li><a class="reference internal" href="#help-em-cluster-config" id="id12">Help — cluster-config</a></li>
<li><a class="reference internal" href="#help-em-cluster-explore" id="id13">Help — cluster-explore</a></li>
<li><a class="reference internal" href="#help-em-cluster-push" id="id14">Help — cluster-push</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generating-cdh-configurations" id="id15">Generating <abbr title="Cloudera Hadoop">CDH</abbr> Configurations</a><ul>
<li><a class="reference internal" href="#script-cluster-generate" id="id16">Script: cluster-generate</a><ul>
<li><a class="reference internal" href="#unique-options" id="id17">Unique Options</a></li>
<li><a class="reference internal" href="#id2" id="id18">Common Options</a></li>
<li><a class="reference internal" href="#example" id="id19">Example</a></li>
<li><a class="reference internal" href="#cdh-json" id="id20">cdh.json</a></li>
</ul>
</li>
<li><a class="reference internal" href="#formulas" id="id21">Formulas</a><ul>
<li><a class="reference internal" href="#cluster" id="id22">Cluster</a><ul>
<li><a class="reference internal" href="#accessing-individual-configurations" id="id23">Accessing Individual Configurations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#log" id="id24">Log</a></li>
<li><a class="reference internal" href="#args" id="id25">Args</a></li>
<li><a class="reference internal" href="#cdh" id="id26">CDH</a></li>
<li><a class="reference internal" href="#atk" id="id27">ATK</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tips" id="id28">Tips</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-cdh-configurations" id="id29">Setting <abbr title="Cloudera Hadoop">CDH</abbr> Configurations</a><ul>
<li><a class="reference internal" href="#id4" id="id30">Common Options</a><ul>
<li><a class="reference internal" href="#id5" id="id31">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#user-cdh-json" id="id32">user-cdh.json</a><ul>
<li><a class="reference internal" href="#finding-keys" id="id33">Finding Keys</a></li>
<li><a class="reference internal" href="#converting-keys" id="id34">Converting Keys</a></li>
<li><a class="reference internal" href="#verifying-json" id="id35">Verifying JSON</a></li>
<li><a class="reference internal" href="#create-cdh-json" id="id36">Create cdh.json</a></li>
<li><a class="reference internal" href="#push-user-cdh-json" id="id37">Push user-cdh.json</a></li>
<li><a class="reference internal" href="#merged-cdh-json" id="id38">merged-cdh.json</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#exploring-cdh-configurations" id="id39">Exploring CDH Configurations</a><ul>
<li><a class="reference internal" href="#id6" id="id40">Common Options</a></li>
</ul>
</li>
</ul>
</div>
<p id="index-0">The cluster configuration tool allows easy updating and optimization of any
<abbr title="Cloudera Hadoop">CDH</abbr> cluster from the command line.
With the use of optimization formulas you can have an optimized <abbr title="Cloudera Hadoop">CDH</abbr> cluster
in a matter of seconds.</p>
<p>The tool does 3 things:</p>
<ul class="simple">
<li>Generate optimized configurations based on your cluster hardware.</li>
<li>Easy updating, restarting, and configuration deployment of <abbr title="Cloudera Hadoop">CDH</abbr> services.</li>
<li>Simple exploration of <abbr title="Cloudera Hadoop">CDH</abbr> cluster configurations.</li>
</ul>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Until the pip package is hosted, you will need to clone and install directly
from source.</p>
<div class="code highlight-python"><div class="highlight"><pre>git clone git@github.intel.com:gao/cluster-config.git
cd cluster-config
[sudo] python setup.py install
</pre></div>
</div>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Python 2.7</li>
<li><a class="reference external" href="https://docs.python.org/2.7/library/argparse.html">argparse</a> &gt;= 1.3.0</li>
<li><a class="reference external" href="https://github.com/cloudera/cm_api">cm-api</a> == 10.0.0</li>
<li>Working <abbr title="Cloudera Hadoop">CDH</abbr> cluster for running the script</li>
</ul>
</div>
</div>
<div class="section" id="help">
<h2>Help<a class="headerlink" href="#help" title="Permalink to this headline">¶</a></h2>
<p>After installing, you will have three executable scripts on your path:
<a class="reference internal" href="#cluster-generate">cluster-generate</a>, <a class="reference internal" href="#cluster-config">cluster-config</a>, and <a class="reference internal" href="#cluster-explore">cluster-explore</a>.</p>
<div class="section" id="common-options">
<span id="id1"></span><h3>Common Options<a class="headerlink" href="#common-options" title="Permalink to this headline">¶</a></h3>
<p>All three scripts have mostly overlapping configurations.</p>
<ul class="simple">
<li><strong>&#8211;host</strong>: <abbr title="Cloudera Hadoop">CDH</abbr> ip or host name, always required</li>
<li><strong>&#8211;port</strong>: <abbr title="Cloudera Hadoop">CDH</abbr> port, default 7180, required if your <abbr title="Cloudera Hadoop">CDH</abbr> manager UI
port is not 7180</li>
<li><strong>&#8211;username</strong>: <abbr title="Cloudera Hadoop">CDH</abbr> username, default &#8216;admin&#8217;, required if your <abbr title="Cloudera Hadoop">CDH</abbr>
manager UI username is not &#8216;admin&#8217;</li>
<li><strong>&#8211;password</strong>: <abbr title="Cloudera Hadoop">CDH</abbr> manager password, if not provided on the command
line you will be asked at runtime</li>
<li><strong>&#8211;cluster</strong>: <abbr title="Cloudera Hadoop">CDH</abbr> cluster name and the name of the cluster if more
than one cluster is managed by cloudera manager.</li>
<li><strong>&#8211;path</strong>: The path we will save and load files, like <em>cdh.json</em>,
default is working directory</li>
<li><strong>&#8211;log</strong>: Log level, defaults to INFO</li>
</ul>
<p>Running any of the scripts with the &#8211;help option will provide help text for
all the command line options.</p>
</div>
<div class="section" id="help-em-cluster-generate">
<span id="help-cluster-generate"></span><h3>Help — cluster-generate<a class="headerlink" href="#help-em-cluster-generate" title="Permalink to this headline">¶</a></h3>
<div class="code highlight-python"><div class="highlight"><pre>$ cluster-generate --help
usage: cluster-generate [-h] [--formula FORMULA] [--formula-args FORMULA_ARGS]
                        --host HOST [--port PORT] [--username USERNAME]
                        [--password PASSWORD] [--cluster CLUSTER]
                        [--path PATH] [--log {INFO,DEBUG,WARNING,FATAL,ERROR}]

Auto generate various CDH configurations based on system resources

optional arguments:
  -h, --help            show this help message and exit
  --formula FORMULA     Auto generation formula file. Defaults to
                        /home/rodorad/Documents/config/atk-
                        config/cluster_config/formula.py
  --formula-args FORMULA_ARGS
                        Auto generation formula arguments to possibly override
                        global configurations.
  --host HOST           Cloudera Manager Host
  --port PORT           Cloudera Manager Port
  --username USERNAME   Cloudera Manager User Name
  --password PASSWORD   Cloudera Manager Password
  --cluster CLUSTER     Cloudera Manager Cluster Name if more than one cluster
                        is managed by Cloudera Manager.
  --path PATH           Directory where we can save/load configurations files.
                        Defaults to working directory
                        /home/rodorad/Documents/config/atk-config
  --log {INFO,DEBUG,WARNING,FATAL,ERROR}
                        Log level [INFO|DEBUG|WARNING|FATAL|ERROR]
</pre></div>
</div>
</div>
<div class="section" id="help-em-cluster-config">
<h3>Help — cluster-config<a class="headerlink" href="#help-em-cluster-config" title="Permalink to this headline">¶</a></h3>
<div class="code highlight-python"><div class="highlight"><pre>$  cluster-config --help
usage: cluster-config [-h] --update-cdh {no,yes} --restart-cdh {no,yes}
                      [--conflict-merge {interactive,user,generated}] --host
                      HOST [--port PORT] [--username USERNAME]
                      [--password PASSWORD] [--cluster CLUSTER] [--path PATH]
                      [--log {INFO,DEBUG,WARNING,FATAL,ERROR}]

Process cl arguments to avoid prompts in automation

optional arguments:
  -h, --help            show this help message and exit
  --update-cdh {no,yes}
                        Should we update CDH with all configurations in
                        cdh.json/user-cdh.json?
  --restart-cdh {no,yes}
                        Should we restart CDH services after configuration
                        changes
  --conflict-merge {interactive,user,generated}
                        When encountering merge conflicts between the
                        generated configuration() and the user configuration()
                        what value should we default to? The &#39;user&#39;,
                        &#39;generated&#39;, or &#39;interactive&#39;resolution
  --host HOST           Cloudera Manager Host
  --port PORT           Cloudera Manager Port
  --username USERNAME   Cloudera Manager User Name
  --password PASSWORD   Cloudera Manager Password
  --cluster CLUSTER     Cloudera Manager Cluster Name if more than one cluster
                        is managed by Cloudera Manager.
  --path PATH           Directory where we can save/load configurations files.
                        Defaults to working directory /home/SOME_USER
  --log {INFO,DEBUG,WARNING,FATAL,ERROR}
                        Log level [INFO|DEBUG|WARNING|FATAL|ERROR]
</pre></div>
</div>
</div>
<div class="section" id="help-em-cluster-explore">
<h3>Help — cluster-explore<a class="headerlink" href="#help-em-cluster-explore" title="Permalink to this headline">¶</a></h3>
<div class="code highlight-python"><div class="highlight"><pre>$ cluster-explore --help
usage: cluster-explore [-h] [--dump DUMP] --host HOST [--port PORT]
                       [--username USERNAME] [--password PASSWORD]
                       [--cluster CLUSTER] [--path PATH]
                       [--log {INFO,DEBUG,WARNING,FATAL,ERROR}]

Process cl arguments to avoid prompts in automation

optional arguments:
  -h, --help            show this help message and exit
  --dump DUMP           If you want to dump all configs without asking pass
                        &#39;yes&#39;. Defaults to &#39;no&#39;.
  --host HOST           Cloudera Manager Host
  --port PORT           Cloudera Manager Port
  --username USERNAME   Cloudera Manager User Name
  --password PASSWORD   Cloudera Manager Password
  --cluster CLUSTER     Cloudera Manager Cluster Name if more than one cluster
                        is managed by Cloudera Manager.
  --path PATH           Directory where we can save/load configurations files.
                        Defaults to working directory
                        /home/SOME_USER/
  --log {INFO,DEBUG,WARNING,FATAL,ERROR}
                        Log level [INFO|DEBUG|WARNING|FATAL|ERROR]
</pre></div>
</div>
</div>
<div class="section" id="help-em-cluster-push">
<h3>Help — cluster-push<a class="headerlink" href="#help-em-cluster-push" title="Permalink to this headline">¶</a></h3>
<p>Combines cluster-generate and cluster-config</p>
<div class="code highlight-python"><div class="highlight"><pre>$ cluster-push --help
usage: cluster-push [-h] [--formula FORMULA] [--formula-args FORMULA_ARGS]
                    --update-cdh {no,yes} --restart-cdh {no,yes}
                    [--conflict-merge {interactive,user,generated}] --host
                    HOST [--port PORT] [--username USERNAME]
                    [--password PASSWORD] [--cluster CLUSTER] [--path PATH]
                    [--log {INFO,DEBUG,WARNING,FATAL,ERROR}]

Auto generate various CDH configurations based on system resources

optional arguments:
  -h, --help            show this help message and exit
  --formula FORMULA     Auto generation formula file. Defaults to
                        /home/rodorad/Documents/config/atk-
                        config/cluster_config/formula.py
  --formula-args FORMULA_ARGS
                        Auto generation formula arguments to possibly override
                        global configurations.
  --update-cdh {no,yes}
                        Should we update CDH with all configurations in
                        cdh.json/user-cdh.json?
  --restart-cdh {no,yes}
                        Should we restart CDH services after configuration
                        changes
  --conflict-merge {interactive,user,generated}
                        When encountering merge conflicts between the
                        generated configuration() and the user configuration()
                        what value should we default to? The &#39;user&#39;,
                        &#39;generated&#39;, or &#39;interactive&#39;resolution
  --host HOST           Cloudera Manager Host
  --port PORT           Cloudera Manager Port
  --username USERNAME   Cloudera Manager User Name
  --password PASSWORD   Cloudera Manager Password
  --cluster CLUSTER     Cloudera Manager Cluster Name if more than one cluster
                        is managed by Cloudera Manager.
  --path PATH           Directory where we can save/load configurations files.
                        Defaults to working directory
                        /home/rodorad/Documents/config/atk-config
  --log {INFO,DEBUG,WARNING,FATAL,ERROR}
                        Log level [INFO|DEBUG|WARNING|FATAL|ERROR]
</pre></div>
</div>
</div>
</div>
<div class="section" id="generating-cdh-configurations">
<span id="cluster-generate"></span><h2>Generating <abbr title="Cloudera Hadoop">CDH</abbr> Configurations<a class="headerlink" href="#generating-cdh-configurations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="script-cluster-generate">
<h3>Script: cluster-generate<a class="headerlink" href="#script-cluster-generate" title="Permalink to this headline">¶</a></h3>
<p>Description: used for generating optimized <abbr title="Cloudera Hadoop">CDH</abbr> configurations</p>
<div class="section" id="unique-options">
<h4>Unique Options<a class="headerlink" href="#unique-options" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>&#8211;formula</strong>: path to formula file if not using the default packaged formula.</li>
<li><strong>&#8211;formula-args</strong>: path to formula arguments to possibly override constants.</li>
</ul>
</div>
<div class="section" id="id2">
<h4>Common Options<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>If you forget the command line options run the script with <strong>&#8211;help</strong> or
visit the <a class="reference internal" href="#help-cluster-generate"><span>help section</span></a>.</p>
<p>Proving only <abbr title="Cloudera Hadoop">CDH</abbr> connection details should be sufficient for generating
optimized configurations since <strong>&#8211;formula</strong> is provided with a default.</p>
<p>The default formula can be found in the repository at
<em>cluster_cofig/formula.py</em>.</p>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-python"><div class="highlight"><pre>$ cluster-generate --host CLOUDERA_HOST --port CLODERA_PORT --username CLOUDERA_USER
What is the Cloudera manager password?
--INFO cluster selected: SOME_CLUSTER
--INFO using formula: cluster_config/formula.py
--INFO Wrote CDH configuration file to: /home/some-user/cdh.json
--INFO Wrote ATK generated configuration file to: /home/some-user/generated.conf
</pre></div>
</div>
<p>After providing the Cloudera manager password, all the cluster details will
be extracted and provided to the formula to calculate an optimized
configuration which gets saved to <em>cdh.json</em>.</p>
<p>The generated.conf file will contain ATK specific configurations.
It can be ignored, if you don&#8217;t intend to use the ATK server for analytics.</p>
<p>The optimized configurations are saved to a file to allow users to view and
verify the configurations before they get saved to <abbr title="Cloudera Hadoop">CDH</abbr> with the
<a class="reference internal" href="#cluster-config">cluster-config</a> script.</p>
<p>Although we take great care to make sure the default formula will work for a
majority of use cases, you should verify the settings to make sure your
cluster will not be adversely affected.</p>
<p>Next we will read <em>cdh.json</em> and update <abbr title="Cloudera Hadoop">CDH</abbr>.</p>
</div>
<div class="section" id="cdh-json">
<span id="id3"></span><h4>cdh.json<a class="headerlink" href="#cdh-json" title="Permalink to this headline">¶</a></h4>
<p>Here is a chd.json file generated on a 4 node cluster</p>
<ul class="simple">
<li>1 node having Cloudera manager</li>
<li>3 nodes running as workers nodes</li>
<li>32 cores</li>
<li>252 gigabytes of memory</li>
</ul>
<div class="code highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;HBASE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;REGIONSERVER&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;REGIONSERVER_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;HBASE_REGIONSERVER_JAVA_HEAPSIZE&quot;</span><span class="p">:</span> <span class="mi">26430567975</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&quot;YARN&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;GATEWAY&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;GATEWAY_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;MAPREDUCE_MAP_JAVA_OPTS_MAX_HEAP&quot;</span><span class="p">:</span> <span class="mi">4129776246</span><span class="p">,</span>
                <span class="s">&quot;MAPREDUCE_MAP_MEMORY_MB&quot;</span><span class="p">:</span> <span class="mi">5368709120</span><span class="p">,</span>
                <span class="s">&quot;MAPREDUCE_REDUCE_JAVA_OPTS_MAX_HEAP&quot;</span><span class="p">:</span> <span class="mi">8259552492</span><span class="p">,</span>
                <span class="s">&quot;MAPREDUCE_REDUCE_MEMORY_MB&quot;</span><span class="p">:</span> <span class="mi">10737418240</span><span class="p">,</span>
                <span class="s">&quot;YARN_APP_MAPREDUCE_AM_MAX_HEAP&quot;</span><span class="p">:</span> <span class="mi">4129776246</span><span class="p">,</span>
                <span class="s">&quot;YARN_APP_MAPREDUCE_AM_RESOURCE_CPU_VCORES&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s">&quot;YARN_APP_MAPREDUCE_AM_RESOURCE_MB&quot;</span><span class="p">:</span> <span class="mi">5368709120</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">&quot;NODEMANAGER&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;NODEMANAGER_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;YARN_NODEMANAGER_RESOURCE_CPU_VCORES&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
                <span class="s">&quot;YARN_NODEMANAGER_RESOURCE_MEMORY_MB&quot;</span><span class="p">:</span> <span class="mi">180388626432</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">&quot;RESOURCEMANAGER&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;RESOURCEMANAGER_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;YARN_SCHEDULER_INCREMENT_ALLOCATION_MB&quot;</span><span class="p">:</span> <span class="mi">536870912</span><span class="p">,</span>
                <span class="s">&quot;YARN_SCHEDULER_MAXIMUM_ALLOCATION_MB&quot;</span><span class="p">:</span> <span class="mi">180388626432</span><span class="p">,</span>
                <span class="s">&quot;YARN_SCHEDULER_MAXIMUM_ALLOCATION_VCORES&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
                <span class="s">&quot;YARN_SCHEDULER_MINIMUM_ALLOCATION_MB&quot;</span><span class="p">:</span> <span class="mi">5368709120</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="formulas">
<h3>Formulas<a class="headerlink" href="#formulas" title="Permalink to this headline">¶</a></h3>
<p>It is possible to create your optimization formulas or copy the default
formula and make your own tweaks.
The formula files are regular python scripts. While the default formula is
called &#8216;formula.py&#8217; their are no restrictions.</p>
<p>The formula files are executed with <a class="reference external" href="https://docs.python.org/2/library/functions.html#execfile">python&#8217;s exec file function</a>.</p>
<div class="section" id="cluster">
<h4>Cluster<a class="headerlink" href="#cluster" title="Permalink to this headline">¶</a></h4>
<p>The cluster variable will contain all installed service, role, config group
and configuration details from the <abbr title="Cloudera Hadoop">CDH</abbr> cluster we are currently connected to.</p>
<p>Lets look at a code sample from formula.py to see how the cluster variable is
being used.</p>
<div class="code highlight-python"><div class="highlight"><pre><span class="o">...</span>
<span class="n">hosts</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">yarn</span><span class="o">.</span><span class="n">nodemanager</span><span class="o">.</span><span class="n">hosts</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">max_cores</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_memory</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hosts</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">hosts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">numCores</span> <span class="o">&gt;</span> <span class="n">max_cores</span><span class="p">:</span>
        <span class="n">max_cores</span> <span class="o">=</span> <span class="n">hosts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">numCores</span>
    <span class="k">if</span> <span class="n">hosts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">totalPhysMemBytes</span> <span class="o">&gt;</span> <span class="n">max_memory</span><span class="p">:</span>
        <span class="n">max_memory</span> <span class="o">=</span> <span class="n">hosts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">totalPhysMemBytes</span>

<span class="o">...</span>
</pre></div>
</div>
<p>On the first line with <strong>cluster.yarn.nodemanager.hosts.all()</strong> we are
retreiving all the details for every host running the yarn node manager role.
The returned object will be a list of cloudera
<a class="reference external" href="http://cloudera.github.io/cm_api/apidocs/v10/ns0_apiHost.html">apihosts</a>.</p>
<p>With the same notation you can retrive the all the details for hosts running
the hbase region server role or all zookeeper servers.</p>
<ul class="simple">
<li><strong>cluster.hbase.regionserver.hosts.all()</strong></li>
<li><strong>cluster.zookeeper.server.hosts.all()</strong></li>
</ul>
<p>You can access all <abbr title="Cloudera Hadoop">CDH</abbr> services, roles, configs, and hosts with the same notation.</p>
<p>The pattern you want to follow is</p>
<ul class="simple">
<li><strong>cluster.SERVICE.ROLE.CONFIG_GROUP.CONFIG</strong></li>
<li><strong>cluster.SERVICE.ROLE.hosts.all</strong></li>
<li><strong>SERVICE</strong> is any valid <abbr title="Cloudera Hadoop">CDH</abbr> <a class="reference external" href="http://cloudera.github.io/cm_api/apidocs/v10/path__clusters_-clusterName-_services.html">service</a></li>
<li><strong>ROLE</strong> is any valid <abbr title="Cloudera Hadoop">CDH</abbr> <a class="reference external" href="http://cloudera.github.io/cm_api/apidocs/v10/path__clusters_-clusterName-_services_-serviceName-_roles.html">role</a></li>
<li><strong>CONFIG_GROUP</strong> is any valid config group from <a class="reference internal" href="#cluster-explore">cluster-explore</a> script.
A good example of a configuration group would be &#8216;gateway_base&#8217; because
just about every service has this role.</li>
<li><strong>CONFIG</strong> is any valid config from <a class="reference internal" href="#cluster-explore">cluster-explore</a> script.
When accessing <abbr title="Cloudera Hadoop">CDH</abbr> services all attributes are lowercase while the keys
displayed by the <a class="reference internal" href="#cluster-explore">cluster-explore</a> script are uppercase.</li>
</ul>
<div class="section" id="accessing-individual-configurations">
<h5>Accessing Individual Configurations<a class="headerlink" href="#accessing-individual-configurations" title="Permalink to this headline">¶</a></h5>
<p>Accessing individual configurations is easy but you must know the
configuration name.
You will need to run the <a class="reference internal" href="#cluster-explore">cluster-explore</a> script to find the full
configuration name.</p>
<p>Here is a config key that was found with <a class="reference internal" href="#cluster-explore">cluster-explore</a>.</p>
<div class="code highlight-python"><div class="highlight"><pre>- name: HBASE_REGIONSERVER_JAVA_HEAPSIZE
- description: Maximum size in bytes for the Java Process heap memory.  Passed to Java -Xmx.
- key: HBASE.REGIONSERVER.REGIONSERVER_BASE.HBASE_REGIONSERVER_JAVA_HEAPSIZE
- value: 26430567975
</pre></div>
</div>
<p>To retrive the following value with the cluster variable make the key all
lower case and prefix cluster.</p>
<p><strong>cluster.hbase.regionserver.regionserver_base.hbase_regionserver_java_heapsize.value</strong></p>
<p>If you look at the implementation for the &#8216;cluster&#8217; objects class you will
notice that you can set all <abbr title="Cloudera Hadoop">CDH</abbr> configurations directly i would cuation
against it. Saving the computed configurations to the <strong>&#8216;cdh&#8217;</strong> dictionary will
allow the user to review the configurations when they get saved to <em>cdh.json</em>
and enable the saving of snapshot for admnistrative purposes.</p>
</div>
</div>
<div class="section" id="log">
<h4>Log<a class="headerlink" href="#log" title="Permalink to this headline">¶</a></h4>
<p>The log variable has four methods available for sending log messages to the
command line:</p>
<ul class="simple">
<li>log.info</li>
<li>log.error</li>
<li>log.warning</li>
<li>log.fatal: does a sys.exit(1) after logging it&#8217;s message.
All the methods take a single string as an argument.</li>
</ul>
</div>
<div class="section" id="args">
<h4>Args<a class="headerlink" href="#args" title="Permalink to this headline">¶</a></h4>
<p>Args is a dictionay of values provided by the user.
The args dictionary gives us the ability to consider the users Constants when
calculating configurations.</p>
<p>When calculating optimized configurations you often need constants to set
threshholds.
The default <strong>formula.py</strong> has several constants to allow for fine tuning.</p>
<p>..code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">NUM_THREADS</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c"># This should be set to the maximum number of munti-tanent users</span>
<span class="n">OVER_COMMIT_FACTOR</span> <span class="o">=</span> <span class="mf">1.30</span>
<span class="n">MAX_JVM_MEMORY</span> <span class="o">=</span> <span class="mi">32768</span> <span class="o">*</span> <span class="n">MiB</span>
<span class="n">MEM_FRACTION_FOR_HBASE</span> <span class="o">=</span> <span class="mf">0.20</span>
<span class="n">MEM_FRACTION_FOR_OTHER_SERVICES</span> <span class="o">=</span> <span class="mf">0.20</span>
<span class="n">MAPREDUCE_JOB_COUNTERS_MAX</span> <span class="o">=</span> <span class="mi">500</span>
</pre></div>
</div>
<p>If the value for <strong>&#8216;NUM_THREADS&#8217;</strong> is given on the command line, that value
in received in <strong>&#8216;args[&#8220;NUM_THREADS&#8221;]&#8217;</strong> allowing for the decision of whether
to use the default or the specified value.</p>
</div>
<div class="section" id="cdh">
<h4>CDH<a class="headerlink" href="#cdh" title="Permalink to this headline">¶</a></h4>
<p>The <strong>&#8216;cdh&#8217;</strong> dictionary is the variable where the calculated <abbr title="Cloudera Hadoop">CDH</abbr>
configurations are saved with the dictionary key being the full key to the
path found with the <a class="reference internal" href="#cluster-explore">cluster-explore</a> script.</p>
<p>When the script has finished running, the contents of the <strong>&#8216;cdh&#8217;</strong> dictionary
are saved to <em>cdh.json</em> so the configurations can be reviewed before updating
<abbr title="Cloudera Hadoop">CDH</abbr>.</p>
<p>For example, if you wanted to save your optimized value for the hbase heap you
would do this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cdh</span><span class="p">[</span><span class="s">&#39;HBASE.REGIONSERVER.REGIONSERVER_BASE.HBASE_REGIONSERVER_JAVA_HEAPSIZE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SOME_MEMORY_SETTING</span>
</pre></div>
</div>
<p>Once the execfile has finished running, the <strong>&#8216;cdh&#8217;</strong> dictionary is exported to
<em>cdh.json</em> which is read by the <a class="reference internal" href="#cluster-config">cluster-config</a> or help_cluster-push scripts to
update <abbr title="Cloudera Hadoop">CDH</abbr>.</p>
</div>
<div class="section" id="atk">
<h4>ATK<a class="headerlink" href="#atk" title="Permalink to this headline">¶</a></h4>
<p>Much like the <strong>&#8216;cdh&#8217;</strong> dictionary, the <strong>&#8216;atk&#8217;</strong> dictionary is the place where
the calculated ATK configurations are saved.
If the ATK, is not being used, the dictionary can be safely ignored.</p>
<p>The key for every value in the <strong>&#8216;atk&#8217;</strong> dictionary would need to be a valid
<a class="reference external" href="https://github.com/intel-data/atk/blob/master/conf/examples/application.conf.tpl">atk configuration key</a>.</p>
</div>
</div>
<div class="section" id="tips">
<h3>Tips<a class="headerlink" href="#tips" title="Permalink to this headline">¶</a></h3>
<p>When saving optimized configurations be aware of the expected format.
For example, a memory setting for <em>yarn</em>, <em>hbase</em>, and <em>spark</em> may require
different formats.
<em>Yarn</em> may expect configuration values expressed in mega bytes, while
<em>hbase</em> and <em>spark</em> expect values expressed in bytes.</p>
<p>Unfortunetly, the <abbr title="Cloudera Hadoop">CDH</abbr> REST API does not always throw formatting errors.
If there are formatting issues, login to <abbr title="Cloudera Hadoop">CDH</abbr> console and look for
configuration warnings concerning the affected services.</p>
</div>
</div>
<div class="section" id="setting-cdh-configurations">
<span id="cluster-config"></span><h2>Setting <abbr title="Cloudera Hadoop">CDH</abbr> Configurations<a class="headerlink" href="#setting-cdh-configurations" title="Permalink to this headline">¶</a></h2>
<p>Script: <strong>cluster-config</strong></p>
<p>Description: Used for updating <abbr title="Cloudera Hadoop">CDH</abbr> with the optimized configurations</p>
<p>Unique Options:</p>
<ul class="simple">
<li><strong>&#8211;update-cdh</strong>: Whether to update <abbr title="Cloudera Hadoop">CDH</abbr> configurations.
Either yes or no.</li>
<li><strong>&#8211;restart-cdh</strong>: Whether to restart <abbr title="Cloudera Hadoop">CDH</abbr> after updating its configuration.
Either yes or no.</li>
<li><strong>&#8211;conflict-merge</strong>: Conflict resolution preference when encountering
key conflicts between cdh.json and <em>user-cdh.json</em>.
Defaults to <em>user-cdh.json</em>.
Valid values [user, generated, interactive]</li>
</ul>
<div class="section" id="id4">
<h3>Common Options<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>If you forget the command line options run the script with <strong>&#8211;help</strong> or
visit the <span class="xref std std-ref">help section</span>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>update-cdh</strong>, and <strong>restart-cdh</strong> options are provided as fail-safe
to keep unwanted changes from potentially breaking a working cluster, and
to keep restarts from stopping long running jobs.</p>
</div>
<div class="section" id="id5">
<h4>Example<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-python"><div class="highlight"><pre>$ cluster-config --host CLOUDERA_HOST --port CLODERA_PORT --username CLOUDERA_USER --update-cdh yes --restart-cdh yes

What is the Cloudera manager password?
--INFO cluster selected: SOME_CLUSTER
--INFO Reading CDH config file: /home/some-user/cdh.json
--WARNING Couldn&#39;t open json file: /home/rodorad/user-cdh.json
--INFO Writting merged CDH config file: /home/some-user/merged-cdh.json
--INFO Updating config group: REGIONSERVER_BASE
--INFO Updated 1 configuration/s.
Restarting service : &quot;HBASE&quot;
.   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .

Deploying configuration for all HBASE roles
.

--INFO Updating config group: NODEMANAGER_BASE
--INFO Updated 2 configuration/s.
--INFO Updating config group: GATEWAY_BASE
--INFO Updated 7 configuration/s.
--INFO Updating config group: RESOURCEMANAGER_BASE
--INFO Updated 4 configuration/s.
Restarting service : &quot;YARN&quot;
.   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .

Deploying configuration for all YARN roles
.
</pre></div>
</div>
<p>After connecting to Cloudera Manager, <em>cdh.json</em> (generated in the <a class="reference external" href="cluster-generate">previous
step</a> and <em>user-cdh.json</em> (if available) are read.</p>
<p>The file <em>user-cdh.json</em> has any user overrides and/or any additional <abbr title="Cloudera Hadoop">CDH</abbr>
configurations needing to be set.
For this example, the <em>user-cdh.json</em> file was omitted.</p>
<p>When <strong>&#8211;update-cdh</strong>, and <strong>&#8211;restart-cdh</strong> are set to &#8216;yes&#8217;, the <abbr title="Cloudera Hadoop">CDH</abbr> needs
to update, and restart <abbr title="Cloudera Hadoop">CDH</abbr> with the configurations from <em>cdh.json</em>/user-cdh.json.</p>
</div>
</div>
<div class="section" id="user-cdh-json">
<h3>user-cdh.json<a class="headerlink" href="#user-cdh-json" title="Permalink to this headline">¶</a></h3>
<p>The <em>user-cdh.json</em> file is where to set any <abbr title="Cloudera Hadoop">CDH</abbr> configurations.
As long the file is in the working directory or in directory specified by
<strong>&#8211;path</strong>, it will be read and pushed to <abbr title="Cloudera Hadoop">CDH</abbr> by the <a class="reference internal" href="#cluster-config">cluster-config</a> script.</p>
<p>A sample <em>user-cdh.json</em> file looks like a <em>cdh.json</em> file.
It can have the same or different keys as a <em>cdh.json</em> file.</p>
<div class="section" id="finding-keys">
<h4>Finding Keys<a class="headerlink" href="#finding-keys" title="Permalink to this headline">¶</a></h4>
<p>For a simple demonstration, look for any key with the <a class="reference internal" href="#cluster-explore">cluster-explore</a>
script to add to our <em>user-cdh.json</em> file.
This example shows
<strong>YARN.JOBHISTORY.JOBHISTORY_BASE.YARN_JOBHISTORY_BIND_WILDCARD</strong>.</p>
<div class="code highlight-python"><div class="highlight"><pre>config:
- Name: YARN_JOBHISTORY_BIND_WILDCARD
- Description: If enabled, the JobHistory Server binds to the wildcard address (&quot;0.0.0.0&quot;) on all of its ports.
- Key: YARN.JOBHISTORY.JOBHISTORY_BASE.YARN_JOBHISTORY_BIND_WILDCARD
- Value: false
</pre></div>
</div>
<p>This is what it looks like in <abbr title="Cloudera Hadoop">CDH</abbr>:</p>
<img alt="f_images/bind_false.png" src="f_images/bind_false.png" />
</div>
<div class="section" id="converting-keys">
<h4>Converting Keys<a class="headerlink" href="#converting-keys" title="Permalink to this headline">¶</a></h4>
<p>To save the key to user-cdh.json format, the key needs to be split at the
each period with each element being nested inside the previous element.</p>
<p>key: <strong>YARN.JOBHISTORY.JOBHISTORY_BASE.YARN_JOBHISTORY_BIND_WILDCARD</strong> would
convert to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;YARN&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;JOBHISTORY&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;JOBHISTORY_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;YARN_JOBHISTORY_BIND_WILDCARD&quot;</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Lets go ahead and add another key that will conflict with our <em>cdh.json</em> file
to see how conflict resolution works.</p>
<p>I added &#8216;<strong>YARN_NODEMANAGER_RESOURCE_CPU_VCORES</strong>&#8216; which is set to 32 cores
in my <em>cdh.json</em>.
Add the key and subtract a couple of cores from the value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;YARN&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;JOBHISTORY&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;JOBHISTORY_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;YARN_JOBHISTORY_BIND_WILDCARD&quot;</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">&quot;NODEMANAGER&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;NODEMANAGER_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;YARN_NODEMANAGER_RESOURCE_CPU_VCORES&quot;</span><span class="p">:</span> <span class="mi">30</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once you have your <em>user-cdh.json</em> file make sure you save it to your working directory.</p>
</div>
<div class="section" id="verifying-json">
<h4>Verifying JSON<a class="headerlink" href="#verifying-json" title="Permalink to this headline">¶</a></h4>
<p>All <em>user-cdh.json</em> files need to contain only valid json text.
If you get parsing errors or have any doubts about your formatting, you can
use a <a class="reference external" href="http://jsonlint.com/">json lint tool</a> to format and error check
your json text.</p>
</div>
<div class="section" id="create-cdh-json">
<h4>Create cdh.json<a class="headerlink" href="#create-cdh-json" title="Permalink to this headline">¶</a></h4>
<p>Once you&#8217;ve saved <em>user-cdh.json</em>, run <a class="reference internal" href="#cluster-generate">cluster-generate</a> to create a
<em>cdh.json</em> file, or verify you have <em>_cdh.json_</em> file in the same working
directory where you saved <em>_user-cdh.json_</em> file.</p>
</div>
<div class="section" id="push-user-cdh-json">
<h4>Push user-cdh.json<a class="headerlink" href="#push-user-cdh-json" title="Permalink to this headline">¶</a></h4>
<p>Running the <a class="reference internal" href="#cluster-config">cluster-config</a> script will automatically push <em>user-cdh.json</em>
configurations to <abbr title="Cloudera Hadoop">CDH</abbr> after merging with <em>cdh.json</em>.</p>
<p>You should see log messages notifying you that <em>user-cdh.json</em> was loaded.</p>
<div class="code highlight-python"><div class="highlight"><pre>$ cluster-config --host SOME_USER --update-cdh yes --restart-cdh no
What is the Cloudera manager password?
--INFO cluster selected: SOME_CLUSTER
--INFO Reading CDH config file: /home/SOME_USER/cdh.json
--INFO Reading user CDH config file: /home/SOME_USER/user-cdh.json
--INFO conflict resolution: first

Key merge conflict: YARN.NODEMANAGER.NODEMANAGER_BASE.YARN_NODEMANAGER_RESOURCE_CPU_VCORES
[user]User value: 30
[auto]Auto generated value: 32
Optionally you can accept [au] all user values or [ag] all auto generated values.
--INFO Auto resolving conflicts. Defaulting to user value
--INFO Writting merged CDH config file: /home/rodorad/merged-cdh.json
--INFO Updating config group: REGIONSERVER_BASE
--INFO Updated 1 configuration/s.
--INFO Updating config group: NODEMANAGER_BASE
--INFO Updated 2 configuration/s.
--INFO Updating config group: JOBHISTORY_BASE
--INFO Updated 1 configuration/s.
--INFO Updating config group: RESOURCEMANAGER_BASE
--INFO Updated 4 configuration/s.
--INFO Updating config group: GATEWAY_BASE
--INFO Updated 7 configuration/s.
</pre></div>
</div>
<p>In above example we see notifications when we load <em>user-cdh.json</em> and how
conflicts were resolved.</p>
<p>The default behavior when encountering conflicting keys is to resolve them to
the user value.
You can change the default behavior on the command line with the
<strong>&#8211;conflict-merge</strong> option.</p>
<p>We also see that a <em>merged-cdh.json</em> file was created.
This file gets created when the <em>user-cdh.json</em> and <em>cdh.json</em> files are
merged.
It is a record of all the configurations that got pushed to <abbr title="Cloudera Hadoop">CDH</abbr> after
resolving key conflicts.</p>
<p>After pushing our changes our <abbr title="Cloudera Hadoop">CDH</abbr> value is updated.</p>
<img alt="f_images/bind_true.png" src="f_images/bind_true.png" />
</div>
<div class="section" id="merged-cdh-json">
<h4>merged-cdh.json<a class="headerlink" href="#merged-cdh-json" title="Permalink to this headline">¶</a></h4>
<p>sample merged-cdh.json file</p>
<div class="code highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;HBASE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;REGIONSERVER&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;REGIONSERVER_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;HBASE_REGIONSERVER_JAVA_HEAPSIZE&quot;</span><span class="p">:</span> <span class="mi">26430567975</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&quot;YARN&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;GATEWAY&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;GATEWAY_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;MAPREDUCE_MAP_JAVA_OPTS_MAX_HEAP&quot;</span><span class="p">:</span> <span class="mi">4129776246</span><span class="p">,</span>
                <span class="s">&quot;MAPREDUCE_MAP_MEMORY_MB&quot;</span><span class="p">:</span> <span class="mi">5368709120</span><span class="p">,</span>
                <span class="s">&quot;MAPREDUCE_REDUCE_JAVA_OPTS_MAX_HEAP&quot;</span><span class="p">:</span> <span class="mi">8259552492</span><span class="p">,</span>
                <span class="s">&quot;MAPREDUCE_REDUCE_MEMORY_MB&quot;</span><span class="p">:</span> <span class="mi">10737418240</span><span class="p">,</span>
                <span class="s">&quot;YARN_APP_MAPREDUCE_AM_MAX_HEAP&quot;</span><span class="p">:</span> <span class="mi">4129776246</span><span class="p">,</span>
                <span class="s">&quot;YARN_APP_MAPREDUCE_AM_RESOURCE_CPU_VCORES&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s">&quot;YARN_APP_MAPREDUCE_AM_RESOURCE_MB&quot;</span><span class="p">:</span> <span class="mi">5368709120</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">&quot;JOBHISTORY&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;JOBHISTORY_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;YARN_JOBHISTORY_BIND_WILDCARD&quot;</span><span class="p">:</span> <span class="s">&quot;True&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">&quot;NODEMANAGER&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;NODEMANAGER_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;YARN_NODEMANAGER_RESOURCE_CPU_VCORES&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                <span class="s">&quot;YARN_NODEMANAGER_RESOURCE_MEMORY_MB&quot;</span><span class="p">:</span> <span class="mi">180388626432</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">&quot;RESOURCEMANAGER&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;RESOURCEMANAGER_BASE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;YARN_SCHEDULER_INCREMENT_ALLOCATION_MB&quot;</span><span class="p">:</span> <span class="mi">536870912</span><span class="p">,</span>
                <span class="s">&quot;YARN_SCHEDULER_MAXIMUM_ALLOCATION_MB&quot;</span><span class="p">:</span> <span class="mi">180388626432</span><span class="p">,</span>
                <span class="s">&quot;YARN_SCHEDULER_MAXIMUM_ALLOCATION_VCORES&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
                <span class="s">&quot;YARN_SCHEDULER_MINIMUM_ALLOCATION_MB&quot;</span><span class="p">:</span> <span class="mi">5368709120</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exploring-cdh-configurations">
<span id="cluster-explore"></span><h2>Exploring CDH Configurations<a class="headerlink" href="#exploring-cdh-configurations" title="Permalink to this headline">¶</a></h2>
<p>Script: <strong>cluster-explore</strong></p>
<p>Description: Browse <abbr title="Cloudera Hadoop">CDH</abbr> configurations by service, role, and configuration
group or dumped all at once to the screen.
Helps find the configuration keys if you want to write your own
<em>user-cdh.json</em> file or if you want to write your own formula file.</p>
<p>Unique Options:</p>
<ul class="simple">
<li><strong>&#8211;dump</strong>: if &#8216;yes&#8217; dumps all the configurations for every service to
stdout.</li>
</ul>
<div class="section" id="id6">
<h3>Common Options<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>If you forget the command line options run the script with <strong>&#8211;help</strong> or
visit the <span class="xref std std-ref">help section</span>.</p>
<p>Finding configurations is quite difficult without an appropriate tool.
The cluster explore script solves this very problem.</p>
<p>It has two run modes:</p>
<ol class="arabic simple">
<li>Print all the configurations for every service to the screen.</li>
<li>Interactively print all the configurations for a specific service, role,
and configuration group.</li>
</ol>
<p>To invoke option 1 you can answer &#8216;yes&#8217; to the &#8211;dump command line option or
answer yes when prompted on the command line.</p>
<div class="code highlight-python"><div class="highlight"><pre>$ cluster-explore --host SOME_HOST --port SOME_PORT --username SOME_USERNAME
What is the Cloudera manager password?
--INFO cluster selected: SOME_CLUSTER
dump all configs[yes or no]: yes

...
- config name: ENABLE_CONFIG_ALERTS
- config description: When set, Cloudera Manager will send alerts when this entity&#39;s configuration changes.
- config key: SPARK_ON_YARN.SPARK_YARN_HISTORY_SERVER.SERVER_BASE.ENABLE_CONFIG_ALERTS
- config value: false

- config name: PROCESS_AUTO_RESTART
- config description: When set, this role&#39;s process is automatically (and transparently) restarted in the event of an unexpected failure.
- config key: SPARK_ON_YARN.SPARK_YARN_HISTORY_SERVER.SERVER_BASE.PROCESS_AUTO_RESTART
- config value: false
...
</pre></div>
</div>
<p>To invoke option 2, run the script interactively.
Answer &#8220;no&#8221; or hit enter when prompted to dump the configurations.</p>
<div class="code highlight-python"><div class="highlight"><pre>$ cluster-explore --host SOME_HOST --port SOME_PORT --username SOME_USERNAME
What is the Cloudera manager password?
--INFO cluster selected: SOME_CLUSTER
dump all configs[yes or no]: no

Available service types on cluster: &#39;cluster&#39;
Pick a service
Id 1 service: HDFS
Id 2 service: HBASE
Id 3 service: ZOOKEEPER
Id 4 service: YARN
Id 5 service: SPARK_ON_YARN
Enter service Id : 4
Selected YARN

Available role types on service: &#39;YARN&#39;
Pick a role
Id 1 role: NODEMANAGER
Id 2 role: JOBHISTORY
Id 3 role: RESOURCEMANAGER
Id 4 role: GATEWAY
Enter role Id : 4
Selected GATEWAY

Available config group types on role: &#39;GATEWAY&#39;
Pick a config group
Id 1 config group: GATEWAY_BASE
Enter config group Id : 1
Selected GATEWAY_BASE

...

config:
- name: MAPRED_OUTPUT_COMPRESSION_CODEC
- description: For MapReduce job outputs that are compressed, specify the compression codec to use. Will be part of generated client configuration.
- key: YARN.GATEWAY.GATEWAY_BASE.MAPRED_OUTPUT_COMPRESSION_CODEC
- value: org.apache.hadoop.io.compress.DefaultCodec

config:
- name: MAPRED_REDUCE_PARALLEL_COPIES
- description: The default number of parallel transfers run by reduce during the copy (shuffle) phase. This number should be between sqrt(nodes*number_of_map_slots_per_node) and nodes*number_of_map_slots_per_node/2. Will be part of generated client configuration.
- key: YARN.GATEWAY.GATEWAY_BASE.MAPRED_REDUCE_PARALLEL_COPIES
- value: 10

config:
- name: MAPREDUCE_JOB_UBERTASK_MAXMAPS
- description: Threshold for number of maps, beyond which a job is considered too big for ubertask optimization.
- key: YARN.GATEWAY.GATEWAY_BASE.MAPREDUCE_JOB_UBERTASK_MAXMAPS
- value: 9

...
</pre></div>
</div>
<p>For every configuration key you will see</p>
<ul class="simple">
<li>configuration name: Normalized configuration name to account for some
weirdness with CDH configuration names like slashes and dashes.</li>
<li>configuration description: This will be the description from CDH UI.</li>
<li>full configuration key path: The format for a key is
SERVICE_TYPE.ROLE_TYPE.CONFIG_GROUP_NAME.CONFIGURATION_KEY.
While composed mostly of types the CONFIG_GROUP_NAME is normalized to
remove service names which can be anything.</li>
<li>value: The value of the configuration.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2015, Intel.
      </li>
      <li>
      Last updated on Aug 13, 2015.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>